defmodule MsBot.Net.PacketBuilder do
  @pong <<0x18, 0x0>>
  @login <<0x01, 0x0>>
  @process_login <<0x9, 0x0, 0x1, 0x1, 0x3, 0x0, 0x0, 0x0, 0x0, 0x0>>
  @show_worlds <<0x0B, 0x0>>
  @select_world <<0x6, 0x0, 0x0, 0x0>>
  @select_channel <<0x5, 0x0, 0x0, 0x0>>
  @channel_info <<0x13, 0x0>>
  @channel_login <<0x14, 0x0>>
  @control_mob <<0x9D, 0x0>>
  @attack <<0x29, 0x0>>

  def pong, do: @pong

  def login() do
    secrets = Application.get_env(:ms_bot, :login)
    user_len = byte_size(secrets[:username])
    username = secrets[:username]
    pass_len = byte_size(secrets[:password])
    pass = secrets[:password]

    @login <>
      <<user_len::little-integer-size(16), username::little-bytes,
        pass_len::little-integer-size(16), pass::little-bytes, 0xB8, 0x8, 0xCF, 0x41, 0x6E, 0x5C,
        0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8A, 0xEF, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0,
        0x0, 0x0, 0x0, 0x0>>
  end

  def process_login(), do: @process_login

  def show_worlds(), do: @show_worlds

  def select_world(), do: @select_world

  def select_channel(), do: @select_channel

  def channel_info(char_id) do
    <<@channel_info, char_id::little-bytes, 0x11, 0x0, 0x42, 0x38, 0x2D, 0x30, 0x38, 0x2D, 0x43,
      0x46, 0x2D, 0x34, 0x31, 0x2D, 0x36, 0x45, 0x2D, 0x35, 0x43, 0x15, 0x0, 0x43, 0x38, 0x35,
      0x42, 0x37, 0x36, 0x33, 0x44, 0x31, 0x46, 0x37, 0x32, 0x5F, 0x30, 0x30, 0x30, 0x30, 0x30,
      0x30, 0x30, 0x30>>
  end

  def channel_login(char_id) do
    <<@channel_login, char_id::little-bytes, 0x0, 0x0>>
  end

  def move_player() do
    char_pos = <<0x5C, 0xFF, 0x3C, 0xFF>>

    <<0x26, 0x0, 0x2, 0x5C, 0xFF, 0x17, 0xFF, 0x4, 0xA, 0x0, 0x0, 0x5C, 0xFF, 0x38, 0xFF, 0x0,
      0x0, 0x68, 0x1, 0x0, 0x0, 0x6, 0xB4, 0x0, 0x0, 0x5C, 0xFF, 0x3C, 0xFF, 0x0, 0x0, 0x0, 0x0,
      0x0, 0x0, 0x6, 0xC, 0x0, 0x0, char_pos::little-bytes, 0x0, 0x0, 0x0, 0x0, 0x7, 0x0, 0x4,
      0x3E, 0x1, 0x11, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x5C, 0xFF, 0x17, 0xFF, 0x5C,
      0xFF, 0x3C, 0xFF>>
  end

  def control_mob(mob_id) do
    char_pos = <<0x5C, 0xFF, 0x3C, 0xFF>>

    <<@control_mob::little-bytes, mob_id::little-integer-size(32), 0x49, 0x2, 0x0, 0xFF, 0x0, 0x0,
      0x0, 0x0, 0x0, 0x1, 0x0, 0xC, 0x0, 0x0, 0x5C, 0xB8, 0x0, 0x1, 0x0, char_pos::little-bytes,
      0x0, 0x0, 0x0, 0x0, 0xF, 0x0, 0x5, 0x38, 0x4, 0x0, 0x45, 0xFF, 0xB8, 0x0, 0x45, 0xFF, 0xB8,
      0x0>>
  end

  def attack(mob_id) do
    # targets and hits
    tbyte = <<0x11>>
    # base attack
    skill_id = <<0x0, 0x0, 0x0, 0x0>>
    # damage
    damage = <<255, 224, 245, 5>>
    # Distance, second half for non-Meso Explosion OR hits for Meso Explosion
    num = <<0x1>>

    <<@attack::little-bytes, 0x0, tbyte::little-bytes, skill_id::little-bytes, 0x0, 0x7, 0x1, 0x4,
      0x5D, 0x75, 0x41, 0x1, mob_id::little-integer-size(32), 0x6, 0x80, 0x4, 0x1, 0xCA, 0x1,
      0xD7, 0x0, 0xCC, 0x1, 0xD7, 0x0, 0x31, num::bytes, damage::little-bytes, 0x84, 0x7F, 0x48,
      0xCD, 0x72, 0x0, 0xD7, 0x0>>
  end
end
